<div *ngIf='patients.length' class="modal fade" role="dialog" tabindex="-1" id="medicModal" style="border-radius:12px;width:auto;">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width:480px;border-radius:0px;border-radius:12px;padding-left:0px;padding-right: 0px;">
            <div class="modal-body" style="border-radius:0px;padding: 0px;">
                <div class="card card-secondary historycard midlecard profilecard" style="margin:auto;min-height:250px;border-radius:12px;">
                    <div style='padding-left: 30px;border-top-right-radius:12px;border-top-left-radius:12px;' class="card-header profileheader small-header">
                        <i *ngIf='cardView.editing||cardView.reversing' (click)="switchViews('orders')" style='position:absolute;left:1%;top:2%; cursor:pointer; display: inline-block;
                          color:#1da1f2;' title="Back" class="icon ion-android-arrow-back "> </i>
                        <div style="left:23px" class="timeline lastdoc priscriber headerdp small-dp">
                            <img [src]=getDp(patients[curIndex].info.personal.avatar)/>
                        </div>
                        <a href="#" class="patien-name small-name">
                          {{patients[curIndex]?.info.personal.firstName + ' '+ patients[curIndex].info.personal.lastName}}<span class="small-headericon"></span>
                        </a>
                        <h6 style='font-size:10px; font-weight:bold; position:absolute;color:dodgerblue;  top:4%;left:76%' class="patien-name small-name">MEDICATIONS</h6>
                    </div>
                    <div *ngIf='cardView.orders' class="card-body orderbody" style=" width:65%; margin:auto;">
                        <div style="border-left:2px solid #1da1f2;height:200px; width:100%;">
                            <div style='border:none' *ngFor="let medic of invoices; let i = index" class="carditem priscriptioncontainer order">
                                <div style='left:-4%' class="timeline condition drugtimeline">
                                    <p class="timelinedate">{{medic[0]?.meta.dateAdded|date:'dd'}}</p>
                                    <p class="timelinedate month"> {{medic[0]?.meta.dateAdded|date:'MMM'|uppercase}}</p>
                                </div>
                                <div *ngFor="let m of medic; let j = index" class="priscription drug">
                                    <h6 class="dept">{{m.name}}&nbsp;<span class="predata"></span>
                                        <span *ngIf="m.paid" class="predata priceval">
                                        <i class="icon ion-ios-checkmark-empty paid-icon"></i></span>
                                        <span *ngIf="!m.paid" class="predata priceval">
                                        <i (click)="selectItem(i,j)" style=' color:lightgrey;'  *ngIf="m.meta.selected" class="icon ion-ios-checkmark-empty paid-icon" title="Deselect "></i>
                                        <div  style='border-color:rgb(216, 216, 216)' *ngIf ="!m.price" class="mycheckbox"></div>
                                        <div  class="mycheckbox" *ngIf="(!m.meta.selected) && (m.price)"  (click)="selectItem(i,j)" ></div>
                                        </span>
                                    </h6>
                                    <h6 class="dept previnfo">Dosage&nbsp;
                                        <span class="predata">{{getDosage(m.desc)}}</span>
                                    </h6>
                                    <h6 class="dept previnfo" style="color:lightgrey">
                                        Price&nbsp;<span [ngStyle]=getStyle(m) style="text-align:right;left:80%;display: inline-block;width:50px" *ngIf=m.price class="predata priceval">{{(m.price) * (m.quantity)}}</span>
                                        <span *ngIf=!m.price class="predata priceval">---</span>
                                    </h6>
                                </div>
                                <!-- <label class='totalLbl' *ngIf='somePaid(i)'>{{getTransTotal(medic)}} </label> -->
                            </div>
                        </div>
                        <div style='left:105%; height:32px;width:32px' title='Process tranasaction' class="floter">
                            <i (click)='switchToEdit()' style='font-size: 23px;left:3px; top:4px;' class="material-icons flotericon">swap_horiz</i>
                        </div>
                    </div>
                    <div *ngIf='cardView.editing' class="card-body orderbody" style="width:75%;margin:auto;">
                            <div style="top:1px; margin-bottom:25px; min-height: 80px;max-height: 120;" class="form-group vitals-section setGroup">
                                <table *ngIf="edited.length" cellspacing="0" class="data-table drugs-table" style="width:100%;left:0%;">
                                    <thead class='productHead'>
                                        <tr class="staff-th">
                                            <th style="padding-left:4px;" class="headlbl staff-th">PRODUCT</th>
                                            <th class="headlbl staff-th">DOSAGE</th>
                                            <!-- <th class="headlbl staff-th">QTY</th> -->
                                            <th style='text-align:center' class="headlbl staff-th">QTY</th>
                                            <th style='text-align:right;padding-right: 15px' class="headlbl staff-th">PRICE</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let med of edited; let i = index; let odd = odd;" style="border-bottom:2px solid white;" [class.even]=odd class="ro staff-row">
                                            <td style="padding-left:4px;" class="data">
                                                {{med.name}}
                                                <span class="predata"></span>
                                            </td>
                                            <td style='font-size:11px' class="data">{{getDosage(med.desc)}}</td>
                                            <td  style='font-size:11px;text-align: right' class="data"><span><input [(ngModel)]="med.quantity" type="number" name="dos" [min]='1' [max] = 'getMaxQty(med)' class="patientdata inputs dataInfo qty-btn"></span>
                                            </td>
                                            <td style='font-size:11px;text-align: right;padding-right: 15px' class="data">
                                                {{med.price * med.quantity}}
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot col-span='4' style='font-size:11px; text-align:right; position:absolute; color:lightgrey; font-weight:bold;padding-right: 15px; border-top: 1px solid whitesmoke;width:100%'>Total:&nbsp;<span style="color: black">{{getPriceTotal()}}</span> </tfoot>
                                </table>
                            </div>
                            <button (click) = updateInvoices()   style=" width: 170px;font-size: 10px; height:27px;left:28%; bottom:24%;" class="btn btn-sm btn-outline-primary inputs mainbtn"> UPDATE INVOICE
                                <span style="position: absolute; bottom: -7%;left: 80%;">
                                <i *ngIf="processing" class="fa fa-circle-o-notch fa-spin fa-10x slow-spin " style="position:absolute;bottom:5px;left:5px;font-size:19px;color: #1da1f2;"> </i>
                                </span>
                            </button>
                    </div>

                    <div *ngIf = 'sucsLine || errLine' style='padding-left: 5px;padding-right:5px;border-top-right-radius: 0px; border-top-left-radius: 0px; z-index: 5; padding-top: 0px; border-top: 1px solid whitesmoke;bottom:0%;
                    position:absolute;width:100%;padding-bottom: 0px;height:32px' class="card-header profileheader small-header sucsLine">
                        <p  style="top:6px;margin-bottom:0px;padding:0px;margin-right:0px; font-weight:normal;position:absolute;text-align:center;width:95%;color:lightgreen" class="patien-name small-name">{{sucsLine}}</p>
                        <p *ngIf = errLine style="top:6px;margin-bottom:0px;padding:0px;margin-right:0px; font-weight:normal;position:absolute;text-align:center;width:95%;color:red" class="patien-name small-name"> {{errLine}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>






<nav class="navbar fixed-top navbar-light navbar-expand-md navigation-clean-search" style="padding:0px; margin-bottom:1px solid whitesmoke;">
    <div class="container">
        <a class="navbar-brand" href="#">
            <em>foldr</em>
        </a>
        <button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="navbar-toggler-icon"></span>
      </button>
        <div class="collapse navbar-collapse" id="navcol-1">
            <ul class="nav navbar-nav"></ul>
            <form class="top-searchform" target="_self">
                <div class="form-group">
                    <input [(ngModel)]=searchTerm #search (keyup)='searchPatient(searchTerm)' autocomplete="off" style="border-radius:.999em;   width:80%;display:inline-block;
                position: absolute;text-align: left;vertical-align: middle;top:11%; box-shadow:none;
               outline:none; background-color: rgba(233, 236, 239, 0.7);
                " class="form-control" type="search" name="search" id="search-field" placeholder="Search patient">
                    <i style='font-size:20px; top:3px;left:83%;position:relative;display:inline' class="icon ion-ios-search " title="Search"></i>
                    <h6 style=' cursor:pointer; font-size:12px;left:98%;position:relative;display:inline-block;color:grey;font-weight:normal;
                      '>Sort: <span style='cursor:pointer; color:#1da1f2;'  (click)='toggleSortMenu()'>
                        {{nowSorting}}</span></h6>
                    <div *ngIf=sortMenu style='position: absolute; left:120%; width:100px;top:6px;height:110px' class="menu">
                        <ul (mouseleave)='toggleSortMenu()' class="actions primary">
                            <li (click)='sortPatients("name")' class="action">A-Z</li>
                            <li (click)='sortPatients("age")' class="action">Age</li>
                            <li (click)='sortPatients("status")' class="action">Status</li>
                            <li (click)='sortPatients("sex")' class="action">Gender</li>
                            <li (click)='sortPatients("date")' class="action">Date added</li>
                        </ul>
                    </div>
                </div>
            </form>
        </div>
    </div>
  
    <div class="timeline lastdoc priscriber headerdp small-dp user-dp" style="left:90%;position:absolute;height:30px;width:30px;top:5px; margin-bottom:0px;"> <img style='height:100%; width:100%; object-fit:cover;' [src]=getMyDp()/></div>
</nav>
<div style="padding-top:60px" class="container">
    <div class="row">
        <div *ngIf='!patients.length' class='issue'>
            <div *ngIf='loading' class="lds-css ng-scope">
                <div style="width:100%;height:100%" class="lds-rolling">
                    <div></div>
                </div>
            </div>
            <div (click)=refresh() *ngIf='message' title='Refresh' class='refresh'><i class="icon ion-ios-reload "></i></div>
            <h6 *ngIf='message' style='font-size:13px;position:absolute;top:65%; width:100%; color:lightgrey;text-align: center'>{{message}}</h6>
        </div>
        <div *ngFor="let patient of patients; let i=index" class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-xs-12">
            <div *ngIf="patient.card.view == 'front'" class="card card-secondary maincard">
                <div style="border-radius:12px" class="card-header profileheader"><i class="icon ion-android-more-vertical headericon moreicon actions-icon"></i>
                    <div class="timeline lastdoc priscriber headerdp">
                        <img [src]=getDp(patient.info.personal.avatar)/>
                    </div>
                </div>
                <p style='margin-bottom:2px;' class="dept displayname">
                    {{patient.info.personal.firstName + ' ' + patient.info.personal.lastName}}<span class="predata editicon"></span></p>
                <div class="card-body mainbody">
                    <div class="carditem basic-item">
                        <h6 class="dept basic-info">Sex</h6>
                        <h6 class="dept basic-info sex-info">
                            {{patient.info.personal.gender.charAt(0).toUpperCase()}}</h6>
                    </div>
                    <div class="carditem basic-item">
                        <h6 class="dept basic-info">Age</h6>
                        <h6 class="dept basic-info sex-info">{{patient.info.personal.dob|dob}}</h6>
                    </div>
                    <div class="carditem basic-item">
                        <h6 class="dept basic-info">Seen</h6>
                        <h6 class="dept basic-info sex-info">{{patient.record.visits.length}}</h6>
                    </div>
                    <div class="priscription basic-subinfo">
                        <div class="sub-container">
                            <h6 class="dept basic-secondary basic-value">
                                {{patient.record.visits[0][0].dept}}</h6>
                        </div>
                        <div class="sub-container">
                            <h6 style="width:100%;text-align:center" class="dept basic-secondary basic-value">
                                {{patient.record.medications[0][0].meta.dateAdded|date:'dd-MM-y'}}&nbsp;<span>
                                {{patient.record.medications[0][0].meta.dateAdded|date:'hh:mma'|lowercase}}</span>
                            </h6>
                        </div>
                    </div>
                </div>
                <button (click)='viewOrders(i)' data-toggle="modal" data-target="#medicModal" style=" width: 95px;font-size: 10px; height:27px;left:52%; bottom:7%;" class="btn btn-sm btn-outline-primary inputs mainbtn"> VIEW ORDERS</button>
            </div>
        </div>
    </div>
</div>